server:
  enabled: true

  service:
    enabled: true
    type: ClusterIP
    port: 80

  verticalAutoscaler:
    enabled: false

  persistentVolume:
    enabled: false

  retention: 15d

  extraScrapeConfigs:
    - job_name: istio-envoy
      kubernetes_sd_configs:
        - role: pod

      relabel_configs:
        # ONLY scrape istio-proxy containers
        - source_labels: [__meta_kubernetes_pod_container_name]
          action: keep
          regex: istio-proxy

        # Rewrite address to Envoy admin port
        - source_labels: [__meta_kubernetes_pod_ip]
          action: replace
          target_label: __address__
          replacement: $1:15090

        # Hardcode metrics path
        - target_label: __metrics_path__
          replacement: /stats/prometheus
